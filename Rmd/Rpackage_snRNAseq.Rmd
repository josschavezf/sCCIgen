---
output: github_document
---

## Tutorial for simuation with `sCCIgen` R package (without the interactive interface). 


### 1. Download R package 
While R docker with a user interface is attractive, experienced users might like the flexibility of R pacakge for running specialized tasks. 

You can install the latest version directly from GitHub with [devtools](https://github.com/hadley/devtools):

```R
install.packages("devtools")
devtools::install_github("songxiaoyu/sCCIgen")
library(sCCIgen)
# If the built-in sCCIgen data is needed for your simulation, load this package as well.
devtools::install_github("songxiaoyu/sCCIgen_data")
library(sCCIgen_data)
````

### 2. Load and clean sample data 

```R
# Download sample data from https://github.com/songxiaoyu/sCCIgen_data/tree/main/input_data. 

load("Github/sCCIgen_data/input_data/snRNAseq_breast_2025_expr.Rdata")
dim(expr)
expr[1:3,1:3]
anno=colnames(expr)
````



### 3. Analysis of the existing data to provide insights into the parameters of the simulation.

Users can split the simulation into into <u> model fitting </u> and  <u> simulation loading fitted model </u> steps to expedite the simulations, especially if it runs for more than one times. 

Specifically, the `sCCIgen` simulation includes two steps: (1) estimating model parameters from the input data, and (2) simulating datasets using the estimated and user-provided parameters. The first step can be time consuming, especially when the input data is large. By splitting the simulation into multiple steps, users can estimate model parameters only once and save the results for future use. This is especially helpful if users may need to run simulations based on the same input data for multiple times. 

#### Task 1: Estimate model parameters from the snRNAseq for simulation.

This is part is to fit the expression data. When sim_method=="copula", it will fit both the gene marignal distribution and gene-gene correlation. When sim_method=="ind", it will only fit the gene marginal distribution. 

Note: If the number of genes or cells are large, model fitting may take some time. It is suggested to selecte a reasonably large sample size per cell type before the model fitting. 

```R

# model fitting 
ModelEst=Est_ModelPara(expr=expr, anno=anno, sim_method='copula', ncores=10)
saveRDS(ModelEst, file="Github/sCCIgen_data/input_data/snRNAseq_breast_2025_fit_w_cor.RDS")

````

Note: Additional tasks are available for simulations with spatial input (not not snRNAseq based) [here](Rpackage_SRT.md). 


### 4. Develop a parameter file

Users need to develop a parameter file. The sample parameter file for snRNAseq based simulation is [here](https://github.com/songxiaoyu/sCCIgen/tree/main/sample_parameter_file/snRNAseq) for downloading and filling in to perform simulations. 


### 5. Run simulation. 

```R
# load parameter file
input="Decoy1_default.tsv"

# Run simulation without the need for refitting the expression models.
ParaSimulation(input=input, ModelFitFile=ModelEst)

# If task 1 is not done, run simulation including fitting the expression models.
ParaSimulation(input=input)


````
